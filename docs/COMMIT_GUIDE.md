# Git æäº¤è§„èŒƒæŒ‡å—

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜äº†é¡¹ç›®çš„ Git æäº¤è§„èŒƒï¼ŒåŒ…æ‹¬ä½¿ç”¨æ–¹æ³•ã€é…ç½®è¯´æ˜å’Œè‡ªåŠ¨åŒ–åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ¨èæ–¹å¼ï¼šä¸€é”®æäº¤
```bash
npm run commit
```
- âœ… **è‡ªåŠ¨æš‚å­˜**æ‰€æœ‰ä¿®æ”¹çš„æ–‡ä»¶
- âœ… **äº¤äº’å¼å¡«å†™**æäº¤ä¿¡æ¯
- âœ… **è‡ªåŠ¨æ£€æŸ¥**æ ¼å¼è§„èŒƒ
- âœ… **æ”¯æŒä¸­æ–‡**æè¿°

### å¤‡ç”¨æ–¹å¼
```bash
npm run commit:cz  # ä½¿ç”¨ Commitizen ç•Œé¢ï¼ˆéœ€æ‰‹åŠ¨ git addï¼‰
```

### æµ‹è¯•é…ç½®
```bash
npm run commit:test  # éªŒè¯ Husky é…ç½®æ˜¯å¦æ­£å¸¸
```

## ğŸ“ æäº¤æ ¼å¼

åŸºäº [Conventional Commits](https://www.conventionalcommits.org/) æ ‡å‡†ï¼š

```
<type>(<scope>): <subject>

[optional body]

[optional footer]
```

### æäº¤ç±»å‹

| ç±»å‹ | å›¾æ ‡ | æè¿° | ç¤ºä¾‹ |
|------|------|------|------|
| `feat` | âœ¨ | æ–°åŠŸèƒ½ | `feat(pages): æ·»åŠ ç”¨æˆ·è®¾ç½®é¡µé¢` |
| `fix` | ğŸ› | é—®é¢˜ä¿®å¤ | `fix(api): ä¿®å¤æ•°æ®åŠ è½½å¤±è´¥é—®é¢˜` |
| `docs` | ğŸ“ | æ–‡æ¡£æ›´æ–° | `docs: æ›´æ–°éƒ¨ç½²æŒ‡å—` |
| `style` | ğŸ’„ | æ ·å¼è°ƒæ•´ | `style(ui): ä¼˜åŒ–ä¸»é¢˜è‰²å½©æ­é…` |
| `refactor` | â™»ï¸ | ä»£ç é‡æ„ | `refactor(utils): é‡æ„å·¥å…·å‡½æ•°` |
| `perf` | âš¡ | æ€§èƒ½ä¼˜åŒ– | `perf(api): ä¼˜åŒ–æ•°æ®æŸ¥è¯¢æ€§èƒ½` |
| `test` | âœ… | æµ‹è¯•ç›¸å…³ | `test: æ·»åŠ ç”¨æˆ·æ¨¡å—å•å…ƒæµ‹è¯•` |
| `build` | ğŸ“¦ | æ„å»ºç›¸å…³ | `build: å‡çº§webpacké…ç½®` |
| `ci` | ğŸ‘· | CI/CD | `ci: æ·»åŠ è‡ªåŠ¨éƒ¨ç½²æµç¨‹` |
| `chore` | ğŸ”§ | å…¶ä»–å˜æ›´ | `chore: æ›´æ–°ä¾èµ–åŒ…ç‰ˆæœ¬` |

### å½±å“èŒƒå›´ï¼ˆå¯é€‰ï¼‰

å¸¸ç”¨èŒƒå›´ï¼š`pages`, `components`, `utils`, `api`, `config`, `cli`, `miniprogram`, `build`, `deps`

### æäº¤ç¤ºä¾‹

```bash
# ç®€å•æäº¤
feat: æ·»åŠ ç”¨æˆ·è®¤è¯åŠŸèƒ½
fix(pages): ä¿®å¤é¦–é¡µåŠ è½½é—®é¢˜
docs: æ›´æ–° API æ–‡æ¡£

# è¯¦ç»†æäº¤
feat(pages): æ·»åŠ ç”¨æˆ·ä¸ªäººä¸­å¿ƒé¡µé¢

- å®ç°ç”¨æˆ·ä¿¡æ¯å±•ç¤º
- æ·»åŠ å¤´åƒä¸Šä¼ åŠŸèƒ½
- æ”¯æŒä¸ªäººä¿¡æ¯ç¼–è¾‘

Closes #123
```

## âš™ï¸ è‡ªåŠ¨åŒ–é…ç½®

### Husky Git Hooks

é¡¹ç›®ä½¿ç”¨ Husky å®ç°è‡ªåŠ¨åŒ–çš„ Git hooksï¼š

#### Pre-commit Hook
```bash
# .husky/pre-commit
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” æ‰§è¡Œ pre-commit æ£€æŸ¥..."

# æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶éœ€è¦æš‚å­˜
if [ -n "$(git diff --name-only)" ]; then
  echo "ğŸ“ è‡ªåŠ¨æš‚å­˜ä¿®æ”¹çš„æ–‡ä»¶..."
  git add .
fi

echo "âœ… Pre-commit æ£€æŸ¥å®Œæˆ"
```

#### Commit-msg Hook
```bash
# .husky/commit-msg
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx --no-install commitlint --edit "$1"
```

### é…ç½®æ–‡ä»¶

#### commitlint.config.js
ç»Ÿä¸€çš„æäº¤è§„èŒƒé…ç½®ï¼Œæ•´åˆäº†ç±»å‹å’ŒèŒƒå›´å®šä¹‰ï¼š

```javascript
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [2, 'always', [
      'feat', 'fix', 'docs', 'style', 'refactor',
      'perf', 'test', 'build', 'ci', 'chore'
    ]],
    'scope-enum': [2, 'always', [
      'pages', 'components', 'utils', 'api', 'config',
      'cli', 'miniprogram', 'build', 'deps'
    ]],
    'subject-max-length': [2, 'always', 100],
    'subject-case': [0]  // å…è®¸ä¸­æ–‡
  }
};
```

### å·¥ä½œæµç¨‹

```
å¼€å‘è€…ä¿®æ”¹ä»£ç 
    â†“
è¿è¡Œ npm run commit
    â†“
husky pre-commit hook è‡ªåŠ¨æš‚å­˜æ–‡ä»¶
    â†“
Commitizen æä¾›äº¤äº’ç•Œé¢
    â†“
é€‰æ‹©æäº¤ç±»å‹ã€è¾“å…¥èŒƒå›´ã€æè¿°ç­‰
    â†“
ç”Ÿæˆç¬¦åˆ Conventional Commits è§„èŒƒçš„æäº¤ä¿¡æ¯
    â†“
git commit æ‰§è¡Œæäº¤
    â†“
husky commit-msg hook éªŒè¯æ ¼å¼
    â†“
æäº¤æˆåŠŸ
```

## ğŸ”§ åˆå§‹åŒ–è®¾ç½®

### æ–°ç¯å¢ƒè®¾ç½®
```bash
# å®‰è£…ä¾èµ–
npm install

# è®¾ç½® Huskyï¼ˆå¦‚æœéœ€è¦ï¼‰
bash scripts/setup-husky.sh

# æµ‹è¯•é…ç½®
npm run commit:test
```

### setup-husky.sh è„šæœ¬åŠŸèƒ½
- åˆå§‹åŒ– husky
- åˆ›å»º pre-commit å’Œ commit-msg hooks
- è®¾ç½®æ–‡ä»¶æƒé™
- éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®

## ğŸš€ ä¸ CI/CD é›†æˆ

æœ¬é¡¹ç›®çš„ CLI å·¥å…·ä¼šè‡ªåŠ¨è·å– Git æäº¤ä¿¡æ¯ä½œä¸ºå°ç¨‹åºä¸Šä¼ æè¿°ï¼Œè§„èŒƒçš„æäº¤ä¿¡æ¯æœ‰åŠ©äºï¼š

1. **æ›´å¥½çš„ç‰ˆæœ¬è¿½è¸ª** - æ¸…æ™°çš„æäº¤å†å²
2. **è‡ªåŠ¨ç”Ÿæˆæ›´æ–°æ—¥å¿—** - æ”¯æŒå¤šç§æ ¼å¼
3. **æé«˜å›¢é˜Ÿåä½œæ•ˆç‡** - ç»Ÿä¸€çš„æäº¤è§„èŒƒ
4. **ä¾¿äºé—®é¢˜å®šä½å’Œå›æ»š** - æ˜ç¡®çš„å˜æ›´è®°å½•

### æ›´æ–°æ—¥å¿—æ ¼å¼
é¡¹ç›®æ”¯æŒä¸‰ç§æ›´æ–°æ—¥å¿—æ ¼å¼ï¼Œè¯¦è§ [CHANGELOG_FORMATS.md](CHANGELOG_FORMATS.md)ï¼š
- **ç®€å•æ ¼å¼** - é€‚åˆå¿«é€Ÿè¿­ä»£
- **è¯¦ç»†æ ¼å¼** - é€‚åˆå¸¸è§„å‘å¸ƒ
- **å˜æ›´æ—¥å¿—æ ¼å¼** - é€‚åˆæ­£å¼å‘å¸ƒï¼ˆæ¨èï¼‰

## â“ å¸¸è§é—®é¢˜

### Q: æäº¤è¢«æ‹’ç»æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥æäº¤ä¿¡æ¯æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œä¿®æ”¹åé‡æ–°æäº¤ã€‚å¸¸è§é—®é¢˜ï¼š
- æäº¤ç±»å‹ä¸åœ¨å…è®¸åˆ—è¡¨ä¸­
- ä¸»é¢˜è¶…è¿‡100å­—ç¬¦
- æ ¼å¼ä¸ç¬¦åˆ `type(scope): subject` è§„èŒƒ

### Q: å¦‚ä½•ä¿®æ”¹æœ€åä¸€æ¬¡æäº¤ä¿¡æ¯ï¼Ÿ
A: ä½¿ç”¨ `git commit --amend` ä¿®æ”¹æœ€åä¸€æ¬¡æäº¤ï¼Œæˆ–ä½¿ç”¨ `git rebase -i` ä¿®æ”¹å†å²æäº¤ã€‚

### Q: å¯ä»¥è‡ªå®šä¹‰æäº¤ç±»å‹å—ï¼Ÿ
A: å¯ä»¥åœ¨ `commitlint.config.js` ä¸­ä¿®æ”¹ `type-enum` å’Œ `scope-enum` è§„åˆ™ã€‚

### Q: å¦‚ä½•ä¸´æ—¶ç¦ç”¨æ£€æŸ¥ï¼Ÿ
A:
```bash
# æ–¹æ³•1ï¼šç¯å¢ƒå˜é‡
HUSKY=0 git commit -m "message"

# æ–¹æ³•2ï¼šè·³è¿‡éªŒè¯ï¼ˆä¸æ¨èï¼‰
git commit -m "message" --no-verify
```

### Q: è‡ªåŠ¨æš‚å­˜åŠŸèƒ½å¤±æ•ˆæ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥ `.husky/pre-commit` æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æœ‰æ‰§è¡Œæƒé™ï¼š
```bash
chmod +x .husky/pre-commit
```

### Q: Commitizen ç•Œé¢æ˜¾ç¤ºå¼‚å¸¸ï¼Ÿ
A: ç¡®ä¿å®‰è£…äº†æ‰€æœ‰ä¾èµ–ï¼š
```bash
npm install inquirer chalk
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **æ—¥å¸¸å¼€å‘**: ä½¿ç”¨ `npm run commit` è·å¾—æœ€ä½³ä½“éªŒ
2. **å›¢é˜Ÿåä½œ**: ç»Ÿä¸€ä½¿ç”¨é¡¹ç›®é…ç½®çš„æäº¤è§„èŒƒ
3. **CI/CD**: åˆ©ç”¨è§„èŒƒåŒ–çš„æäº¤ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆæ›´æ–°æ—¥å¿—
4. **ç‰ˆæœ¬ç®¡ç†**: ç»“åˆè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ (SemVer) ä½¿ç”¨
