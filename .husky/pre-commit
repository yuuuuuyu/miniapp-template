#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” æ‰§è¡Œ pre-commit æ£€æŸ¥..."

# è·å–æš‚å­˜çš„æ–‡ä»¶
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|ts)$')

if [ -n "$STAGED_FILES" ]; then
  echo "ğŸ“ æ£€æŸ¥ä»£ç æ ¼å¼å’Œè¯­æ³•..."

  # è¿è¡Œ ESLint æ£€æŸ¥æš‚å­˜çš„æ–‡ä»¶
  echo "ğŸ”§ è¿è¡Œ ESLint æ£€æŸ¥..."
  npx eslint $STAGED_FILES

  if [ $? -ne 0 ]; then
    echo "âŒ ESLint æ£€æŸ¥å¤±è´¥ï¼è¯·ä¿®å¤ä»£ç é—®é¢˜åå†æäº¤ã€‚"
    echo "ğŸ’¡ æç¤ºï¼šè¿è¡Œ 'npm run lint:fix' å¯ä»¥è‡ªåŠ¨ä¿®å¤éƒ¨åˆ†é—®é¢˜"
    exit 1
  fi

  echo "âœ… ESLint æ£€æŸ¥é€šè¿‡"
else
  echo "â„¹ï¸  æ²¡æœ‰ JavaScript/TypeScript æ–‡ä»¶éœ€è¦æ£€æŸ¥"
fi

echo "âœ… Pre-commit æ£€æŸ¥å®Œæˆ"
